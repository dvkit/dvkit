<project default="mk_msi">
	<condition
		property="wix"
		value="c:/Program Files (x86)/WiX Toolset v3.7"
		else="c:/Program Files/WiX Toolset v3.7">
		<os arch="amd64"/>
	</condition>
	<property file="${script.dir}/../etc/dvkit_info.properties"/>
	<property name="candle" value="candle.exe"/>
	<property name="light" value="light.exe"/>
	<property name="script.dir" value="${basedir}/scripts"/>
	<property name="etc.dir" value="${basedir}/etc"/>
	<property name="dest" value="${basedir}/dvkit.msi"/>
	<property name="ProgramFilesFolder" value="ProgramFilesFolder"/>
	<property name="Win64" value="no"/>
	
	<target name="mk_msi" depends="mk_filelist">
		<exec executable="${candle}" failonerror="true">
			<arg value="${script.dir}/dvkit.wxs"/>
			<arg value="-dversion=${dvkit_version}"/>
			<arg value="-dbasedir=${basedir}"/>
			<arg value="-detc.dir=${etc.dir}"/>
			<arg value="-darch=${arch}"/>
			<arg value="-dProgramFilesFolder=${ProgramFilesFolder}"/>
			<arg value="-dWin64=${Win64}"/>
			<arg value="-ext"/>
			<arg value="WixUIExtension"/>
		</exec>
		<exec executable="${light}" failonerror="true">
			<arg value="dvkit.wixobj"/>
			<arg value="-ext"/>
			<arg value="WixUIExtension"/>
		</exec>
		<copy tofile="${dest}" file="${basedir}/dvkit.msi"/>
	</target>
	
	<target name="mk_filelist">
		<exec executable="cscript" failonerror="true">
			<arg value="${script.dir}/wxigen.js"/>
			<arg value="${basedir}"/>
			<arg value="${basedir}/dvkit_files.wxi"/>
		</exec>
	</target>
</project>
